<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cant seem to make you mind</title>
<link rel="stylesheet" href="/assets/css/styles.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">

    <link rel="stylesheet" type="text/css" href="/assets/css/monokai.css">
  </head>
  <body data-bs-theme="dark">
    <header class="d-flex py-3 mb-4 border-bottom" style="align-items: center; justify-content: space-around;">
    <a href="/" class="d-flex align-items-center text-dark text-decoration-none">
      <span class="fs-4"><span class="logo1">Hack</span><span class="logo2">vens</span></span>
    </a>
    <button id="btnSwitch" class="">üí°/üåô</button>
    <script defer="defer">
      document.getElementById('btnSwitch').addEventListener('click',()=>{
      if (document.body.getAttribute('data-bs-theme') == 'dark') {
          document.body.setAttribute('data-bs-theme','light')
          document.documentElement.style.setProperty("--logo-color1", "#161616")
      }
      else {
          document.body.setAttribute('data-bs-theme','dark')
          document.documentElement.style.setProperty("--logo-color1", "#fff")

      }
      })
    </script>
  </header>
    <div class="container">
     <div class="post">
    <div class="post__back">
    	<a href="/">&lt;-- home</a>
    </div>
    <div class="post__title">
    	<h1>Sthack 2023 / Cant seem to make you mind</h1>
	<i>June 30, 2023</i>
    </div>
    <div class="post__meta">
    	<p></p>
    </div>
    <div class="post__content"?>
        <p>Voici un petit write up d‚Äôun challenge physique propos√© de lors de la Sthack 2023  : Can‚Äôt seem to make you mind¬†</p>

<p>Ce challenge nous mettait dans la peau d‚Äôun Hacktiviste cherchant √† s‚Äôinfiltrer dans les locaux de Evil Corp. Derri√®re une porte prot√©g√©e par un Code PIN se trouve tous leurs sale petits secrets, et malheureusement pour eux : on a obtenu ce code et on va bient√¥t pouvoir les expos√©s √† la face du monde.</p>

<p>MAIS, car il y a toujours un mais (√† l‚Äôimage d‚Äôun √©pisode de Mr Robot, avoir le code ne suffit pas car le syst√®me est prot√©g√© par une double authentification : un OTP (One Time Password) est envoy√© par SMS et il faut rentrer ce code dans les <strong>3 minutes</strong> et en moins de <strong>10 tentatives</strong>. Et bien √©videmment : nous n‚Äôavons pas acc√®s √† ce t√©l√©phone.</p>

<p>L√† vous vous dites : <em>‚ÄúMais comment contourner une MFA, cette s√©curit√© sp√©cifiquement con√ßu pour v√©rifier l‚Äôidentit√© de la personne qui rentre un mot de passe ?</em>‚Äù</p>

<p>Tout d‚Äôabord, pour resituer les choses, nous avions acc√®s √† un v√©ritable boitier d‚Äôacc√®s dont voici une reproduction √† nu (qui ne rend pas hommage au soin apport√© √† la finition par le concepteur du chall mais que voulez vous, dans le feu de l‚Äôaction √† 5h du matin, on oublie de prendre des photos)
<img src="/assets/img/sthack2023/cantseemtomakeyoumind/c00414212c715b81be848b01f6a9d1a3.png" alt="c00414212c715b81be848b01f6a9d1a3.png" /></p>

<p>Nous avions √©galement acc√®s √† la doc explicative ainsi qu‚Äôau code de l‚Äôapplication et gr√¢ce √† lui, on peut d‚Äôores et d√©j√† noter une premi√®re information depuis les directives include : 
Le boitier utilise un Raspberry Pico comme micro controleur :</p>

<p><img src="/assets/img/sthack2023/cantseemtomakeyoumind/b74edf8351cf5356fea3368f5f965955.png" alt="b74edf8351cf5356fea3368f5f965955.png" /></p>

<p>Tout d‚Äôabord, nous avons regard√© du c√¥t√© de l‚Äôenvoi de SMS si y a pas possibilit√© de modifier le code pour recevoir le SMS, mais les valeurs sont √©crite en dur dans le programme.</p>

<p><img src="/assets/img/sthack2023/cantseemtomakeyoumind/25b261150b0e312f4290d7a7d7185753.png" alt="25b261150b0e312f4290d7a7d7185753.png" /></p>

<p>Et puis en regardant comment l‚ÄôOTP est g√©n√©r√©, nous avons tout de suite remarqu√© une chose : 
La seed (la valeur initial qui est utilis√©e pour cr√©er de l‚Äôal√©atoire et donc √©viter que le mot de passe soit pr√©dictible) n‚Äôutilise pas la fa√ßon habituelle de faire des micro controleur :</p>

<p>En effet, d‚Äôhabitude pour cr√©er une seed, les micro contoleur vont lire la valeur du voltage sur une de leur borne qui n‚Äôest reli√© √† aucun composant : la valeur va ainsi d√©pendre du bruit ambient (onde radio, interf√©rence des t√©l√©phones portables, fond diffus cosmologique etc‚Ä¶). Ce qui rend la pr√©diction quasiment impossible.</p>

<p>Or ici, la seed est r√©cup√©r√©e √† partir de la valeur de la temp√©rature relev√© par un capteur interne :</p>

<p><img src="/assets/img/sthack2023/cantseemtomakeyoumind/fdbaf316187c94cc69cc39a57d53e806.png" alt="fdbaf316187c94cc69cc39a57d53e806.png" /></p>

<p>Et une temp√©rature :  √ßa peut se controler et si on connait la valeur que va renvoyer le capteur, on peut ainsi pr√©voir la valeur du code OTP.</p>

<p>A notre disposition, il y a en effet une bombe √† froid dont la fiche technique sp√©cifie la temp√©rature exacte (En l‚Äôoccurence la notre √©tait √† -35 C¬∞) :</p>

<p><img src="/assets/img/sthack2023/cantseemtomakeyoumind/090fdf58368c7c63863d649655bb7a9a.png" alt="090fdf58368c7c63863d649655bb7a9a.png" /></p>

<p>D√©sormais nous n‚Äôavions plus qu‚Äô√† lire la datasheet technique du Raspberry Pico afin de trouver des informations sur comment le catpeur lit la temp√©rature et surtout sous quel format la fonction <em>read_onboard_temperature()</em> renvoit la valeur.</p>

<p><img src="/assets/img/sthack2023/cantseemtomakeyoumind/6291c0153bc28b1f135e90a9707d0e28.png" alt="6291c0153bc28b1f135e90a9707d0e28.png" /></p>

<p>Alors nous avons recherch√© dans ce document de 639 pages https://datasheets.raspberrypi.com/rp2040/rp2040-datasheet.pdf 
, l‚Äôinformation qu‚Äôil nous fallait et √† la page 566 nous avons trouv√© ceci :</p>

<p><img src="/assets/img/sthack2023/cantseemtomakeyoumind/75b339ff373fc15088f967dd870fc823.png" alt="75b339ff373fc15088f967dd870fc823.png" /></p>

<p>Super, plus qu‚Äô√† faire une simple √©quation pour retrouver la valeur <em>raw</em> pour T= -35, super facile non ? ‚Ä¶ non ?</p>

<p>Et c‚Äôest ici que malheureusement, nous avons √©chou√© car oui cher lecteur ou lectrice : 
le flag on l‚Äôa pas eu.</p>

<p>Je pourrais vous lister tout un tas d‚Äôexcuse √† base de manque de sommeil et de temps, de nos outils qui ont mal g√©r√© les nombres √† virgules etc..  Bref √ßa n‚Äôa pas march√©.</p>

<p>Mais en reprenant √† froid (et en discutant avec le cr√©ateur du challenge), voici le r√©sultat qui aurait pu nous apporter le flag :</p>

<p>Nous savons que la temp√©rature est calcul√© comme ceci :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>uint16_t raw = adc_read();
const float conversion_factor = 3.3f / (1&lt;&lt;12); 
float result = raw * conversion_factor;
float temp = 27 - (result -0.706)/0.001721;
</code></pre></div></div>

<p>Si on effectue l‚Äôop√©ration inverse, nous pouvons d√©finir l‚Äôexpression suivante :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>raw = ((27 - (-35)) * 0.001721 + 0.706) / conversion_factor
raw = 0.812702 / (3.3 / 4096)
raw = 1008,7355733333 = 1008 (vu qu'√† l'origine c'est un type int)
</code></pre></div></div>

<p>On reprend le code de l‚Äôapplication qu‚Äôon modifie pour obtenir la valeur de l‚ÄôOTP :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#define OTP_MIN 100000
#define OTP_MAX 999999

int main(void){
	int read_value_for_negative_35 = 1008;
	unsigned int seed = read_value_for_negative_35 + 324092;
	srand(seed);		 
	int otp = OTP_MIN + rand() % (OTP_MAX + 1 - OTP_MIN); 
	printf("l'OTP est : %d\n", otp);
	return(1);
	}
</code></pre></div></div>

<p><img src="/assets/img/sthack2023/cantseemtomakeyoumind/8d1337025d434fbf4c0033890fc18baf.png" alt="8d1337025d434fbf4c0033890fc18baf.png" /></p>

<p>Il nous aurait ensuite fallu refroidire le boitier jusqu‚Äô√† une temp√©rature de -35 C¬∞ puis entr√©e le code PIN initial puis l‚ÄôOTP pour ouvrir la porte et acc√©der aux sombres secrets de Evil Corp.</p>


    </div>
</div>


    </div>
  </body>
</html>
